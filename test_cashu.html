<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cashu test</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <div x-data="wallet">
    <input readonly @click="$el.select()" x-model="quote.request">
    <pre x-text="JSON.stringify(quote, null, 2)"></pre>
    <button @click="updateQuote">update quote</button>

    <pre x-text="JSON.stringify(proofs, null, 2)"></pre>
    <button @click="mint">mint</button>

    <pre x-text="JSON.stringify(info, null, 2)"></pre>
    <button @click="updateInfo">update info</button>
  </div>

  <script type="module">
    import Alpine from 'https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/module.esm.js';
    import { CashuMint, CashuWallet, MintQuoteState } from 'https://esm.sh/@cashu/cashu-ts@1.1.0';


    function createWallet() {
      const mintUrl = 'http://localhost:3338';
      const mint = new CashuMint(mintUrl);
      Alpine.data('wallet', () => ({
        wallet: null,
        info: {},
        quote: {},
        proofs: [],

        async init() {
          this.wallet = new CashuWallet(mint, { unit: 'sat' });

          // await this.updateQuote();
          // await this.updateInfo();
        },

        async updateQuote() {
          this.quote = await this.wallet.createMintQuote(64);
        },

        async updateInfo() {
          this.info = await this.wallet.getMintInfo();
        },

        async mint() {
          const mintQuoteChecked = await wallet.checkMintQuote(mintQuote.quote);
          if (mintQuoteChecked.state == MintQuoteState.PAID) {
            const { proofs } = await this.wallet.mintTokens(64, mintQuote.quote);
            this.proofs = proofs;
          }
        }
      }));
    }

    globalThis.addEventListener('alpine:init', () => {
      // TODO: get started!
      console.log('alpine init');

      createWallet();
    });

    Alpine.start();
  </script>
</body>

</html>